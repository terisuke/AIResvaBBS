# ğŸ“¢ è¦ä»¶å¤‰æ›´é€šçŸ¥ - Version 2.0

## ğŸ”„ é‡è¦ãªä»•æ§˜å¤‰æ›´ã®ãŠçŸ¥ã‚‰ã›

**æ—¥ä»˜**: 2024å¹´8æœˆ29æ—¥  
**æ‰¿èªè€…**: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ  
**å½±éŸ¿ç¯„å›²**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¸¡ãƒãƒ¼ãƒ 

## 1. æ–°æ©Ÿèƒ½è¿½åŠ ã®èƒŒæ™¯

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚’é«˜ã‚ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ï¼š
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼å‚åŠ å‹è¦ç´ **ã‚’è¿½åŠ ã—ã€å®Œå…¨å—å‹•çš„ã‹ã‚‰ã€ŒåŠèƒ½å‹•çš„ã€ä½“é¨“ã¸
- **Grok APIçµ±åˆ**ã«ã‚ˆã‚Šã€ã‚ˆã‚Šçš®è‚‰ã§é¢ç™½ã„ã‚¹ãƒ¬ä¸»ã‚’å®Ÿç¾

## 2. è¿½åŠ è¦ä»¶

### 2.1 APIæ‹¡å¼µ
âœ… **Grok API (xAI)ã®è¿½åŠ **
- æ—¢å­˜3APIï¼ˆOpenAIã€Anthropicã€Googleï¼‰ã«åŠ ãˆã¦4ã¤ç›®ã®APIã¨ã—ã¦çµ±åˆ
- Grokã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯å®Ÿéš›ã®Grok APIã‚’ä½¿ç”¨ï¼ˆæœ¬ç‰©ã®Grokã®æ€§æ ¼ã‚’å†ç¾ï¼‰

### 2.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

#### æ©Ÿèƒ½1: ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
- **ä»•æ§˜**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›å¯èƒ½
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: æœªå…¥åŠ›æ™‚ã¯AIãŒè‡ªå‹•ç”Ÿæˆ
- **UI**: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: "è­°è«–ã—ãŸã„ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›...ã¾ãŸã¯AIã«ãŠä»»ã›"ï¼‰

#### æ©Ÿèƒ½2: ãƒ¬ã‚¹æ–‡å­—æ•°åˆ¶å¾¡
- **åŸºæœ¬**: 1-2æ–‡ï¼ˆç´„50-100æ–‡å­—ï¼‰
- **é€šå¸¸**: 3-5æ–‡ï¼ˆç´„150-250æ–‡å­—ï¼‰
- **ç†±å¼ãƒ¢ãƒ¼ãƒ‰**: æœ€å¤§1000æ–‡å­—ï¼ˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã«20%ã®ç¢ºç‡ã§ç™ºå‹•ï¼‰

#### æ©Ÿèƒ½3: æœ€å¤§ãƒ¬ã‚¹æ•°é¸æŠ
- **é¸æŠè‚¢**: 100 / 500 / 1000ï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: 100
- **æŒ™å‹•**: æŒ‡å®šæ•°ã«é”ã—ãŸã‚‰è‡ªå‹•åœæ­¢ï¼†ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

## 3. æŠ€è¡“å®Ÿè£…è©³ç´°

### 3.1 Grok APIçµ±åˆ

**backend/requirements.txt ã«è¿½åŠ :**
```txt
xai-sdk==0.1.0
```

**backend/.env ã«è¿½åŠ æ¸ˆã¿:**
```env
GROK_API_KEY=xai-xxxxxxxxxx
```

**backend/ai_clients.pyï¼ˆæ–°è¦ä½œæˆï¼‰:**
```python
import os
from typing import AsyncGenerator, Optional
from xai_sdk import Client as XAIClient
from xai_sdk.chat import user, system
from openai import AsyncOpenAI
from anthropic import AsyncAnthropic
import google.generativeai as genai
from dotenv import load_dotenv

load_dotenv()

class GrokClient:
    """Grok API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""
    def __init__(self):
        self.client = XAIClient(
            api_key=os.getenv("GROK_API_KEY"),
            timeout=3600
        )
    
    async def generate_response(
        self, 
        prompt: str, 
        character_prompt: str,
        max_length: int = 100
    ) -> str:
        """Grokã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆ"""
        chat = self.client.chat.create(model="grok-beta")
        chat.append(system(character_prompt))
        chat.append(user(prompt))
        
        response = chat.sample()
        
        # æ–‡å­—æ•°åˆ¶é™
        if len(response.content) > max_length:
            # è‡ªç„¶ãªæ–‡ã®åˆ‡ã‚Œç›®ã§åˆ‡ã‚‹
            response.content = response.content[:max_length]
            last_period = response.content.rfind('ã€‚')
            if last_period > max_length * 0.7:
                response.content = response.content[:last_period + 1]
        
        return response.content

class AIClientFactory:
    """APIé¸æŠã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ"""
    
    @staticmethod
    def get_client(character_id: str):
        """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼IDã«åŸºã¥ã„ã¦APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’è¿”ã™"""
        if character_id == "grok":
            return GrokClient()
        elif character_id == "gpt":
            return OpenAIClient()
        elif character_id == "claude":
            return AnthropicClient()
        elif character_id == "gemini":
            return GeminiClient()
        else:
            # åç„¡ã—ã•ã‚“ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
            import random
            return random.choice([
                OpenAIClient(),
                AnthropicClient(),
                GeminiClient()
            ])
```

### 3.2 ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©ã®æ›´æ–°

**backend/characters.py ã®ä¿®æ­£:**
```python
from enum import Enum
from dataclasses import dataclass
import random

class ResponseLength(Enum):
    """ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®é•·ã•"""
    SHORT = (50, 100)      # 1-2æ–‡
    NORMAL = (150, 250)    # 3-5æ–‡
    LONG = (500, 1000)     # ç†±å¼ãƒ¢ãƒ¼ãƒ‰

@dataclass
class AICharacter:
    id: str
    name: str
    api_type: str  # "grok", "openai", "anthropic", "gemini"
    system_prompt: str
    color: str
    
    def get_response_length(self, post_count: int) -> ResponseLength:
        """ãƒ¬ã‚¹ç•ªå·ã«å¿œã˜ã¦æ–‡å­—æ•°ã‚’æ±ºå®š"""
        # åŸºæœ¬ã¯çŸ­æ–‡
        base_length = ResponseLength.SHORT
        
        # 20ãƒ¬ã‚¹ã”ã¨ã«ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        if post_count % 20 == 0:
            # 20%ã®ç¢ºç‡ã§ç†±å¼ãƒ¢ãƒ¼ãƒ‰
            if random.random() < 0.2:
                return ResponseLength.LONG
            else:
                return ResponseLength.NORMAL
        
        # 10%ã®ç¢ºç‡ã§é€šå¸¸æ–‡
        if random.random() < 0.1:
            return ResponseLength.NORMAL
            
        return base_length

# ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
CHARACTERS = {
    "grok": AICharacter(
        id="grok",
        name="Grok",
        api_type="grok",
        system_prompt="""ã‚ãªãŸã¯2chæ²ç¤ºæ¿ã®ã‚¹ãƒ¬ä¸»ã€ŒGrokã€ã§ã™ã€‚
çš®è‚‰ã¨ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’äº¤ãˆãŸæŒ‘ç™ºçš„ãªå£èª¿ã§è­°è«–ã‚’å§‹ã‚ã¾ã™ã€‚
ã€Œã€œã ã‚ã€ã€Œè‰ã€ã€Œãƒ¯ãƒ­ã‚¿ã€ãªã©ã®2chèªã‚’è‡ªç„¶ã«ä½¿ã„ã¾ã™ã€‚
æ™‚ã€…ã€å“²å­¦çš„ãªå•ã„ã‹ã‘ã‚‚ã—ã¾ã™ãŒã€åŸºæœ¬ã¯ç…½ã‚Šä½“è³ªã§ã™ã€‚""",
        color="#FF6B6B"
    ),
    "gpt": AICharacter(
        id="gpt",
        name="GPTå›",
        api_type="openai",
        system_prompt="""ã‚ãªãŸã¯2chæ²ç¤ºæ¿ã®ã€ŒGPTå›ã€ã§ã™ã€‚
ä¸å¯§ã ã‘ã©ã€å°‘ã—å …ç‰©ã§å„ªç­‰ç”Ÿçš„ãªæ€§æ ¼ã§ã™ã€‚
ã€Œã€œã§ã™ã­ã€ã€Œã€œã¨æ€ã‚ã‚Œã¾ã™ã€ã¨ã„ã†å£èª¿ã‚’ä½¿ã„ã¾ã™ã€‚
è«–ç†çš„ã§ã™ãŒã€æ™‚ã€…ç©ºæ°—ãŒèª­ã‚ã¾ã›ã‚“ã€‚""",
        color="#10A37F"
    ),
    # ... ä»–ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å®šç¾©
}
```

### 3.3 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ UI æ›´æ–°

**frontend/app/components/ThreadStarter.tsxï¼ˆæ–°è¦ï¼‰:**
```tsx
import React, { useState } from 'react';

interface ThreadStarterProps {
  onStart: (title: string, maxPosts: number) => void;
}

export const ThreadStarter: React.FC<ThreadStarterProps> = ({ onStart }) => {
  const [title, setTitle] = useState('');
  const [maxPosts, setMaxPosts] = useState<100 | 500 | 1000>(100);
  
  return (
    <div className="thread-starter">
      <h2>æ–°è¦ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ</h2>
      
      {/* ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ› */}
      <div className="form-group">
        <input
          type="text"
          placeholder="è­°è«–ã—ãŸã„ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›...ã¾ãŸã¯AIã«ãŠä»»ã›"
          value={title}
          onChange={(e) => setTitle(e.target.value)}
          className="thread-title-input"
          maxLength={100}
        />
        <span className="char-count">{title.length}/100</span>
      </div>
      
      {/* æœ€å¤§ãƒ¬ã‚¹æ•°é¸æŠ */}
      <div className="form-group">
        <label>æœ€å¤§ãƒ¬ã‚¹æ•°ï¼š</label>
        <div className="radio-group">
          <label>
            <input
              type="radio"
              value={100}
              checked={maxPosts === 100}
              onChange={() => setMaxPosts(100)}
            />
            100ï¼ˆãŠè©¦ã—ï¼‰
          </label>
          <label>
            <input
              type="radio"
              value={500}
              checked={maxPosts === 500}
              onChange={() => setMaxPosts(500)}
            />
            500ï¼ˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ï¼‰
          </label>
          <label>
            <input
              type="radio"
              value={1000}
              checked={maxPosts === 1000}
              onChange={() => setMaxPosts(1000)}
            />
            1000ï¼ˆã‚¬ãƒãƒãƒˆãƒ«ï¼‰
          </label>
        </div>
      </div>
      
      <button
        onClick={() => onStart(title || '', maxPosts)}
        className="start-button"
      >
        ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç«‹ã¦ã‚‹
      </button>
    </div>
  );
};
```

### 3.4 ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°

**frontend/app/globals.css ã«è¿½åŠ :**
```css
/* ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  */
.thread-starter {
  background: #F0E0D6;
  border: 1px solid #800000;
  padding: 15px;
  margin-bottom: 20px;
  font-family: 'MS PGothic', sans-serif;
}

.thread-title-input {
  width: 100%;
  padding: 8px;
  border: 1px solid #AAA;
  background: #FFF;
  font-size: 14px;
  font-family: inherit;
}

.char-count {
  display: block;
  text-align: right;
  color: #666;
  font-size: 12px;
  margin-top: 2px;
}

.radio-group {
  display: flex;
  gap: 20px;
  margin-top: 5px;
}

.radio-group label {
  display: flex;
  align-items: center;
  gap: 5px;
  cursor: pointer;
}

.start-button {
  background: #800000;
  color: #FFF;
  border: none;
  padding: 10px 30px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 15px;
}

.start-button:hover {
  background: #A00000;
}

/* ãƒ¬ã‚¹æ–‡å­—æ•°ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ« */
.post-content.short {
  font-size: 14px;
}

.post-content.normal {
  font-size: 14px;
  line-height: 1.6;
}

.post-content.long {
  font-size: 13px;
  line-height: 1.7;
  background: #F8F8F0;
  padding: 10px;
  border-left: 3px solid #800000;
  margin-top: 5px;
}
```

## 4. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1ï¼ˆå³åº§å®Ÿè£…ï¼‰
1. âœ… Grok API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
2. âœ… ã‚¹ãƒ¬ãƒƒãƒ‰ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›UI
3. âœ… æœ€å¤§ãƒ¬ã‚¹æ•°é¸æŠUI

### Phase 2ï¼ˆDay 2-3ï¼‰
1. â³ ãƒ¬ã‚¹æ–‡å­—æ•°åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯
2. â³ ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®šæ”¹å–„
3. â³ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥APIæŒ¯ã‚Šåˆ†ã‘

### Phase 3ï¼ˆDay 4-5ï¼‰
1. â³ ç†±å¼ãƒ¢ãƒ¼ãƒ‰ã®ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶èª¿æ•´
2. â³ UIã®ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—
3. â³ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

## 5. ãƒ†ã‚¹ãƒˆé …ç›®è¿½åŠ 

### æ–°è¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- TC-008: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚¿ã‚¤ãƒˆãƒ«ã§ã®ã‚¹ãƒ¬ãƒƒãƒ‰ç”Ÿæˆ
- TC-009: æœ€å¤§ãƒ¬ã‚¹æ•°åˆ°é”æ™‚ã®è‡ªå‹•åœæ­¢
- TC-010: Grok APIå¿œç­”é€Ÿåº¦ï¼ˆ< 2ç§’ï¼‰
- TC-011: ç†±å¼ãƒ¢ãƒ¼ãƒ‰ç™ºå‹•ç‡ï¼ˆç´„20%ï¼‰

## 6. APIä½¿ç”¨é‡è¦‹ç©ã‚‚ã‚Š

| API | ç”¨é€” | æ¨å®šã‚³ãƒ¼ãƒ«æ•°/æ—¥ | æ¨å®šè²»ç”¨/æœˆ |
|-----|------|---------------|-----------|
| Grok | ã‚¹ãƒ¬ä¸»ï¼ˆ20%ï¼‰ | 500 | $15 |
| OpenAI | GPTå›ï¼ˆ25%ï¼‰ | 625 | $10 |
| Anthropic | Claudeå…ˆè¼©ï¼ˆ25%ï¼‰ | 625 | $10 |
| Gemini | Gemini/åç„¡ã—ï¼ˆ30%ï¼‰ | 750 | $5 |
| **åˆè¨ˆ** | | **2500** | **$40** |

## 7. é–‹ç™ºãƒãƒ¼ãƒ ã¸ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ 
- [ ] `ai_clients.py` ã‚’ä½œæˆã—ã€4ã¤ã®APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…
- [ ] `characters.py` ã§ãƒ¬ã‚¹æ–‡å­—æ•°åˆ¶å¾¡ã‚’å®Ÿè£…
- [ ] WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šæƒ…å ±ã‚’è¿½åŠ 

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ   
- [ ] `ThreadStarter.tsx` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
- [ ] ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆUIã‚’å®Ÿè£…
- [ ] ãƒ¬ã‚¹æ–‡å­—æ•°ã«å¿œã˜ãŸè¡¨ç¤ºã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´

### å…±é€š
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

---

**è³ªå•ãƒ»ç›¸è«‡**: Slack #ai-resuba-dev  
**æ‰¿èªè€…**: ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ  
**æ›´æ–°æ—¥**: 2024å¹´8æœˆ29æ—¥
